<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QRコード読み取り</title>
  <style>
    video { width: 100%; max-width: 400px; }
    #result { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>QRコード読み取り</h1>
  <button id="startBtn">読み取り開始</button>
  <video id="video" autoplay></video>
  <div id="result">結果: <span id="output"></span></div>

  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
  <script>
    const startBtn = document.getElementById('startBtn');
    const video = document.getElementById('video');
    const output = document.getElementById('output');

    startBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      video.srcObject = stream;

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      const scan = () => {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const code = jsQR(imageData.data, canvas.width, canvas.height);
          if (code) {
            output.textContent = code.data;
          }
        }
        requestAnimationFrame(scan);
      };
      scan();
    };
  </script>
</body>
</html>
